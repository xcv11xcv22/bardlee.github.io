---
tags:
  - Linux
title: Fedora41 升版 42 的大災難錯誤
created: 2025-07-15T15:00:00
modified: 2025-07-15T15:00:00
---
近期幫我的桌機從 Fedora 41 升級到 Fedora 42，這是我第二次升級 Fedora 41。第一次是協助 Intel 125H 微電腦（內顯）升級，過程很順利，因此這次操作稍微輕忽。

這兩次升級的主要差異在於：

1. 桌機有安裝 Nvidia 官方驅動。
    
2. 這次使用手機 USB 網路分享，升級重開機後，疑似未自動連上網路，導致升級過程中部分套件未能完整更新。
    

升級後進入系統時，畫面只有白屏，並顯示「系統有錯誤，請聯絡管理員」，無法進入登入畫面，也無法進行任何操作。

透過 Grub，在對應 kernel 的 linux 行加入 `nomodeset 3`，強制以文字模式啟動，進入 TTY 修復模式。

一開始懷疑是 Nvidia 驅動與新版 GNOME 相容性問題，嘗試過移除與重裝官方及 Rpmfusion 驅動，但無法解決，系統依然無法進入圖形介面。

進一步檢查發現，`cat /etc/os-release` 顯示已為 Fedora 42，但系統內部仍有不少套件維持在 41 版本（例如 GNOME 與某些核心元件）。  
這種版本混雜，導致 GNOME 啟動時崩潰，無法進入桌面，只能進 TTY 模式維修。


# 操作紀錄

由於先前曾誤刪 NetworkManager，導致開機時網路完全沒啟動，網卡也沒拿到 IP。

**網路完全沒啟動，網卡沒 IP**

### 修復步驟（臨時手動啟用網卡）


1. **啟動網卡**
```shell
先透過ip addr找到網卡 如enp6s0
sudo ip link set enp6s0 up
```
2. 手動分配 IP（路由器所在網段）
```shell
sudo ip addr add 192.168.1.123/24 dev enp6s0
sudo ip route add default via 192.168.1.1
```
（這邊 `192.168.1.1` 家 or 公司的閘道器，通常是路由器 IP）
3. 設置 DNS 解析（臨時）
```shell
echo "nameserver 8.8.8.8" | sudo tee /etc/resolv.conf
```
4. 測試網路是否通
```shell
ping -c 3 8.8.8.8
ping -c 3 mirrors.fedoraproject.org
```

### 處理套件同步與衝突

使用 `dnf distro-sync` 同步時，遇到多個套件依賴衝突或版本錯誤。

目前解法為：

- 先移除出錯套件
	```
	  sudo dnf remove <出錯套件>
	```
	- 先將有問題（如升級衝突、版本錯誤或殘留）的套件移除，讓依賴樹恢復乾淨，避免後續操作又被同一個問題卡住。
- 再安裝必要套件
	```bash
	sudo dnf install <必要套件>
	```
	- 重新安裝所需的核心/重要套件，確保使用的是新版本並補齊所有依賴。

- 重複執行 `distro-sync`，直到全部同步完成。必要時可加上 `--allowerasing` 參數強制排除有衝突的舊套件。
  


### 補充建議

- 網路連線不穩或升級途中網路中斷，是造成系統版本混雜的主因，**升級時建議全程使用穩定的有線網路**，並確認所有套件都已完整升級。
    
- 針對無法同步或依賴衝突，建議每次遇到報錯時，先確認錯誤訊息，針對特定套件移除再安裝，並多次重複同步，直到不再出現衝突。


目前持續Debug中